<?xml version="1.0" encoding="utf-8"?>
<ui:AvatarCreatorViewBase xmlns:fx="http://ns.adobe.com/mxml/2009" 
						  xmlns:s="library://ns.adobe.com/flex/spark" 
						  xmlns:ui="uk.co.dubit.platform.components.avatarEditor.ui.*" 
						  width="600" height="400" currentState="login"
						  horizontalCenter="0" verticalCenter="0">	
	<fx:Script>
		<![CDATA[
			import flash.net.navigateToURL;
			
			import mx.events.FlexEvent;
			
			import uk.co.dubit.platform.components.avatarEditor.AvatarEditors;
			import uk.co.dubit.platform.data.IAvatar;
			
			private function onWindowClosed():void
			{
				navigateToURL(new URLRequest("http://www.dubitplatform.com"), "_self");
			}
			
			private function login() : void
			{
				if(currentState != "login") 
				{
					currentState = "login";
				}
				else
				{
					avatarEditor.dispatchGAMLEvent("onLogin", {
						"avatarEditor": avatarEditor,
						"username": usernameInput.text,
						"password": passwordInput.text
					});
				}
				
			}
			
			private function register() : void
			{
				if(currentState != "register") 
				{
					currentState = "register";
				}
				else
				{
					var avatar:IAvatar = AvatarEditors.getInstance().getDefaultAvatarByGender("male");
					
					avatar.avatarName = avatarNameInput.text;
					
					avatarEditor.dispatchGAMLEvent("onCreateAvatar", {
						"avatarEditor": avatarEditor,
						"username": usernameInput.text,
						"password": passwordInput.text,
						"avatar": avatar
					});
				}
			}
			
		]]>
	</fx:Script>
	
	<ui:states>
		<s:State name="login" />
		<s:State name="register" />
	</ui:states>

		
	<s:TitleWindow width="100%" height="100%" title="Login or create avatar" close="onWindowClosed()">
		
		<s:Form horizontalCenter="0" verticalCenter="0" defaultButton="{ loginButton }">
			<s:FormItem label="Username">
				<s:TextInput id="usernameInput" widthInChars="25" text="richard" />
			</s:FormItem>
			
			<s:FormItem label="Password">
				<s:TextInput id="passwordInput" widthInChars="25" displayAsPassword="true" text="password"/>
			</s:FormItem>
			
			<s:FormItem label="Avatar Name" includeIn="register">
				<s:TextInput id="avatarNameInput" widthInChars="25" errorString="Enter avatar name" />
			</s:FormItem>
				
			<s:FormItem label="Avatar Gender" includeIn="register">
				<s:TextInput id="avatarGenderInput" widthInChars="25" errorString="Select avatar gender" />
			</s:FormItem>
			
			<s:FormItem width="100%">
				<s:HGroup width="100%" horizontalAlign="center">
					<s:Button id="loginButton" label="Login" emphasized="true" accentColor.login="green" click="login()" />
					
					<s:Button label="Register" emphasized="true" accentColor.register="green" click="register()" />
				</s:HGroup>
			</s:FormItem>
		</s:Form>
	</s:TitleWindow>

</ui:AvatarCreatorViewBase>